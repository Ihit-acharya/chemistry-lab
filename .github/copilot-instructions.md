# Chemistry Lab AI Coding Instructions

## Big picture
- Static frontend (vanilla JS + Bootstrap) lives in [frontend/](frontend/) and can be served by Express for local dev; backend handles auth and persistence. See [backend/server.js](backend/server.js).
- Chemistry behaviors are data-driven: reactions live in [backend/data/reactions.json](backend/data/reactions.json) and are generated by [generate_reactions.py](generate_reactions.py).
- The lab UI is a large client-state machine in [frontend/js/lab.js](frontend/js/lab.js) centered on `labState` and movable containers.

## Key flows and boundaries
- Auth: [backend/server.js](backend/server.js) exposes `/api/login` + `/api/register`; client logic in [frontend/js/auth.js](frontend/js/auth.js) stores `loggedIn`/`userName` in localStorage.
- Protected pages must gate with `isLoggedIn()` (see [frontend/js/auth.js](frontend/js/auth.js)) and redirect to [frontend/Loginpage.html](frontend/Loginpage.html).
- Reaction lookup is commutative: normalize keys client-side before reading [backend/data/reactions.json](backend/data/reactions.json). 

## Project-specific conventions
- Reaction key normalization pattern in [frontend/js/lab.js](frontend/js/lab.js):
  - `const parts = [a,b].map(c => c.toUpperCase()).sort();`
  - `const key = parts.join('+');`
- `labState` is in-memory only; no persistence across sessions.
- Containers are DOM elements with `data-type` attributes; `makeMovable()` powers drag/drop in [js/lab.js](js/lab.js).
- Navbar auth UI is injected via `renderProfileInNavbar()` (see [js/auth.js](js/auth.js)).

## Critical data files
- Chemical catalog: [backend/data/reactants.json](backend/data/reactants.json)
- Equipment catalog: [backend/data/equipment.json](backend/data/equipment.json)
- User credentials: [backend/data/userauth.json](backend/data/userauth.json)

## Developer workflows
- Run server: `cd backend` then `npm install` then `node server.js` (serves http://localhost:3000).
- Generate reactions: `python generate_reactions.py` (overwrites [backend/data/reactions.json](backend/data/reactions.json), backup at [backend/data/reactions.json.bak](backend/data/reactions.json.bak)).
- Validate reactions: `python tools/check_reactions.py`.
- UI E2E: `python tools/ui_playwright_test.py`.

## Common edits
- Add chemical: update [backend/data/reactants.json](backend/data/reactants.json); then regenerate reactions.
- Add reaction rule: edit [generate_reactions.py](generate_reactions.py) and re-run generation.
- Add apparatus: update [backend/data/equipment.json](backend/data/equipment.json) and DOM handling in [frontend/js/lab.js](frontend/js/lab.js).
- Quiz behavior: [frontend/js/quiz.js](frontend/js/quiz.js) + [frontend/quiz.html](frontend/quiz.html).

## Known quirks
- [backend/server.js](backend/server.js) auto-migrates plaintext passwords to bcrypt (`$2` prefix) on startup.
- Large [backend/data/reactions.json](backend/data/reactions.json) (~16K entries) can affect initial load time.

