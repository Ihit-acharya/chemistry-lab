<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Login — Chemistry Lab</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="css/style.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		.login-card { max-width: 420px; margin: 6vh auto; }
		.flask-lg { font-size: 48px; }
	</style>
</head>
<body class="page-scroll">

<nav class="navbar navbar-expand-lg navbar-dark custom-nav">
	<div class="container">
		<a class="navbar-brand" href="homepage.html"><i class="fa-solid fa-flask-vial"></i> Chemistry Lab</a>
		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="mainNav">
			<ul class="navbar-nav ms-auto">
				<li class="nav-item"><a class="nav-link" href="homepage.html"><i class="fa-solid fa-house"></i> Home</a></li>
				<li class="nav-item"><a class="nav-link" href="labpage.html"><i class="fa-solid fa-atom"></i> Lab</a></li>
				<li class="nav-item"><a class="nav-link" href="quizhome.html"><i class="fa-solid fa-circle-question"></i> Quiz</a></li>
				<li class="nav-item"><a class="nav-link" href="about.html"><i class="fa-solid fa-circle-info"></i> About</a></li>
			</ul>
		</div>
	</div>
</nav>

<div class="container">
	<div class="card login-card glass-card">
		<div class="card-body">
			<div class="text-center mb-3">
				<div class="flask-lg text-primary"><i class="fa-solid fa-flask"></i></div>
				<h3 class="card-title mt-2">Sign in</h3>
				<p class="text-muted">Use your chemistry lab account</p>
			</div>

			<form id="loginForm">
				<div class="mb-3">
					<label for="username" class="form-label">Username</label>
					<input type="text" class="form-control glass-input" id="username" required>
				</div>

				<div class="mb-3">
					<label for="password" class="form-label">Password</label>
					<input type="password" class="form-control glass-input" id="password" required>
				</div>

				<div id="alert" class="alert alert-danger d-none" role="alert"></div>

				<div class="d-grid">
					<button type="submit" id="submitBtn" class="btn btn-primary">Sign in</button>
				</div>
			</form>
			<div class="text-center mt-3 text-muted small">
				<br>
				Don't have an account? <a href="signup.html">Sign up</a>
			</div>
		</div>
	</div>
</div>

<footer class="footer mt-auto">
	<p class="text-center mt-4"><i class="fa-solid fa-graduation-cap"></i> Chemistry Lab Project | Grade 11 | Nepal</p>
</footer>

<script>
document.getElementById('loginForm').addEventListener('submit', async function(e) {
	e.preventDefault();
	const username = document.getElementById('username').value.trim();
	const password = document.getElementById('password').value;
	const alertEl = document.getElementById('alert');
	alertEl.classList.add('d-none');

	try {
		const res = await fetch('/api/login', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ username, password })
		});

		const data = await res.json();
		if (!res.ok) {
			alertEl.textContent = data.message || 'Login failed';
			alertEl.classList.remove('d-none');
			return;
		}

		// success — set localStorage and redirect to requested page (if any)
		localStorage.setItem('loggedIn', 'true');
		localStorage.setItem('userName', data.name || username);
		const redirect = localStorage.getItem('postLoginRedirect');
		if (redirect) {
			localStorage.removeItem('postLoginRedirect');
			window.location.href = redirect;
		} else {
			window.location.href = 'labpage.html';
		}

	} catch (err) {
		alertEl.textContent = 'Server error — please try again';
		alertEl.classList.remove('d-none');
	}
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/auth.js"></script>
<script>
	if (window.auth && typeof window.auth.renderProfileInNavbar === 'function') {
		window.auth.renderProfileInNavbar();
	}
</script>

</body>
</html>
